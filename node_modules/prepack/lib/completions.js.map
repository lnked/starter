{"version":3,"sources":["../src/completions.js"],"names":["Completion","constructor","value","location","target","NormalCompletion","AbruptCompletion","ThrowCompletion","realm","nativeStack","Error","stack","isInPureScope","reportSideEffectCallback","undefined","ContinueCompletion","BreakCompletion","ReturnCompletion","JoinedAbruptCompletions","joinCondition","consequent","consequentEffects","alternate","alternateEffects","intrinsics","empty","containsCompletion","CompletionType","containsBreakOrContinue","transferChildrenToPossiblyNormalCompletion","PossiblyNormalCompletion","$Realm","savedPathConditions","savedEffects","result","loc","expressionLocation"],"mappings":"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","file":"completions.js","sourcesContent":["/**\n * Copyright (c) 2017-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n\n/* @flow */\n\nimport type { BabelNodeSourceLocation } from \"babel-types\";\nimport invariant from \"./invariant.js\";\nimport type { Effects, Realm } from \"./realm.js\";\nimport { AbstractValue, Value } from \"./values/index.js\";\n\nexport class Completion {\n  constructor(value: Value, location: ?BabelNodeSourceLocation, target?: ?string) {\n    this.value = value;\n    this.target = target;\n    this.location = location;\n  }\n\n  value: Value;\n  target: ?string;\n  location: ?BabelNodeSourceLocation;\n}\n\n// Normal completions are returned just like spec completions\nexport class NormalCompletion extends Completion {}\n\n// Abrupt completions are thrown as exeptions, to make it a easier\n// to quickly get to the matching high level construct.\nexport class AbruptCompletion extends Completion {}\n\nexport class ThrowCompletion extends AbruptCompletion {\n  constructor(realm: Realm, value: Value, location: ?BabelNodeSourceLocation, nativeStack?: ?string) {\n    super(value, location);\n    this.nativeStack = nativeStack || new Error().stack;\n    if (realm.isInPureScope() && realm.reportSideEffectCallback !== undefined) {\n      realm.reportSideEffectCallback(\"EXCEPTION_THROWN\", undefined, location);\n    }\n  }\n\n  nativeStack: string;\n}\nexport class ContinueCompletion extends AbruptCompletion {\n  constructor(value: Value, location: ?BabelNodeSourceLocation, target: ?string) {\n    super(value, location, target || null);\n  }\n}\n\nexport class BreakCompletion extends AbruptCompletion {\n  constructor(value: Value, location: ?BabelNodeSourceLocation, target: ?string) {\n    super(value, location, target || null);\n  }\n}\n\nexport class ReturnCompletion extends AbruptCompletion {\n  constructor(value: Value, location: ?BabelNodeSourceLocation) {\n    super(value, location);\n  }\n}\n\nexport class JoinedAbruptCompletions extends AbruptCompletion {\n  constructor(\n    realm: Realm,\n    joinCondition: AbstractValue,\n    consequent: AbruptCompletion,\n    consequentEffects: Effects,\n    alternate: AbruptCompletion,\n    alternateEffects: Effects\n  ) {\n    super(realm.intrinsics.empty, consequent.location);\n    this.joinCondition = joinCondition;\n    this.consequent = consequent;\n    this.consequentEffects = consequentEffects;\n    this.alternate = alternate;\n    this.alternateEffects = alternateEffects;\n  }\n\n  joinCondition: AbstractValue;\n  consequent: AbruptCompletion;\n  consequentEffects: Effects;\n  alternate: AbruptCompletion;\n  alternateEffects: Effects;\n\n  containsCompletion(CompletionType: typeof Completion): boolean {\n    if (this.consequent instanceof CompletionType) return true;\n    if (this.alternate instanceof CompletionType) return true;\n    if (this.consequent instanceof JoinedAbruptCompletions) {\n      if (this.consequent.containsCompletion(CompletionType)) return true;\n    }\n    if (this.alternate instanceof JoinedAbruptCompletions) {\n      if (this.alternate.containsCompletion(CompletionType)) return true;\n    }\n    return false;\n  }\n\n  containsBreakOrContinue(): boolean {\n    if (this.consequent instanceof BreakCompletion || this.consequent instanceof ContinueCompletion) return true;\n    if (this.alternate instanceof BreakCompletion || this.alternate instanceof ContinueCompletion) return true;\n    if (this.consequent instanceof JoinedAbruptCompletions) {\n      if (this.consequent.containsBreakOrContinue()) return true;\n    }\n    if (this.alternate instanceof JoinedAbruptCompletions) {\n      if (this.alternate.containsBreakOrContinue()) return true;\n    }\n    return false;\n  }\n\n  transferChildrenToPossiblyNormalCompletion(): PossiblyNormalCompletion {\n    return new PossiblyNormalCompletion(\n      this.value.$Realm.intrinsics.empty,\n      this.joinCondition,\n      this.consequent,\n      this.consequentEffects,\n      this.alternate,\n      this.alternateEffects,\n      []\n    );\n  }\n}\n\n// Possibly normal completions have to be treated like normal completions\n// and are thus never thrown. At the end of a try block or loop body, however,\n// action must be taken to deal with the possibly abrupt case of the completion.\nexport class PossiblyNormalCompletion extends NormalCompletion {\n  constructor(\n    value: Value,\n    joinCondition: AbstractValue,\n    consequent: Completion | Value,\n    consequentEffects: Effects,\n    alternate: Completion | Value,\n    alternateEffects: Effects,\n    savedPathConditions: Array<AbstractValue>,\n    savedEffects: void | Effects = undefined\n  ) {\n    invariant(consequent === consequentEffects.result);\n    invariant(alternate === alternateEffects.result);\n    invariant(\n      consequent instanceof NormalCompletion ||\n        consequent instanceof Value ||\n        alternate instanceof NormalCompletion ||\n        alternate instanceof Value\n    );\n    invariant(consequent instanceof AbruptCompletion || alternate instanceof AbruptCompletion);\n    invariant(\n      value === consequent ||\n        consequent instanceof AbruptCompletion ||\n        (consequent instanceof NormalCompletion && value === consequent.value)\n    );\n    invariant(\n      value === alternate ||\n        alternate instanceof AbruptCompletion ||\n        (alternate instanceof NormalCompletion && value === alternate.value)\n    );\n    let loc =\n      consequent instanceof AbruptCompletion\n        ? consequent.location\n        : alternate instanceof Completion\n          ? alternate.location\n          : alternate.expressionLocation;\n    super(value, loc);\n    this.joinCondition = joinCondition;\n    this.consequent = consequent;\n    this.consequentEffects = consequentEffects;\n    this.alternate = alternate;\n    this.alternateEffects = alternateEffects;\n    this.savedEffects = savedEffects;\n    this.savedPathConditions = savedPathConditions;\n  }\n\n  joinCondition: AbstractValue;\n  consequent: Completion | Value;\n  consequentEffects: Effects;\n  alternate: Completion | Value;\n  alternateEffects: Effects;\n  savedEffects: void | Effects;\n  // The path conditions that applied at the time of the oldest fork that caused this completion to arise.\n  savedPathConditions: Array<AbstractValue>;\n\n  containsCompletion(CompletionType: typeof Completion): boolean {\n    if (this.consequent instanceof CompletionType) return true;\n    if (this.alternate instanceof CompletionType) return true;\n    if (this.consequent instanceof JoinedAbruptCompletions || this.consequent instanceof PossiblyNormalCompletion) {\n      if (this.consequent.containsCompletion(CompletionType)) return true;\n    }\n    if (this.alternate instanceof JoinedAbruptCompletions || this.alternate instanceof PossiblyNormalCompletion) {\n      if (this.alternate.containsCompletion(CompletionType)) return true;\n    }\n    return false;\n  }\n\n  containsBreakOrContinue(): boolean {\n    if (this.consequent instanceof BreakCompletion || this.consequent instanceof ContinueCompletion) return true;\n    if (this.alternate instanceof BreakCompletion || this.alternate instanceof ContinueCompletion) return true;\n    if (this.consequent instanceof JoinedAbruptCompletions || this.consequent instanceof PossiblyNormalCompletion) {\n      if (this.consequent.containsBreakOrContinue()) return true;\n    }\n    if (this.alternate instanceof JoinedAbruptCompletions || this.alternate instanceof PossiblyNormalCompletion) {\n      if (this.alternate.containsBreakOrContinue()) return true;\n    }\n    return false;\n  }\n}\n"]}