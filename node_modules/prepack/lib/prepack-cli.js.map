{"version":3,"sources":["../src/prepack-cli.js"],"names":["run","Object","Array","console","JSON","process","prepackStdin","prepackFileSync","FatalError","CompatibilityValues","fs","HELP_STR","map","v","join","args","from","argv","splice","inputFilenames","outputFilename","check","compatibility","mathRandomSeed","inputSourceMap","outputSourceMap","statsFileName","maxStackDepth","timeout","debugIdentifiers","lazyObjectsRuntime","heapGraphFilePath","debugInFilePath","debugOutFilePath","reactOutput","reproFilePath","cpuprofilePath","invariantMode","invariantLevel","flags","initializeMoreModules","trace","debugNames","emitConcreteModel","inlineExpressions","logStatistics","logModules","delayInitializations","delayUnsupportedRequires","accelerateUnsupportedRequires","internalDebug","debugScopes","serialize","residual","profile","reactEnabled","reproArguments","reproFileNames","inputFile","fileName","push","basename","length","arg","shift","startsWith","slice","includes","error","exit","value","isNaN","parseInt","toString","seconds","debugIdentifiersString","split","range","unshift","pair","Number","MAX_SAFE_INTEGER","start","isInteger","count","invariantLevelString","options","flag","keys","log","option","undefined","zip","content","readFileSync","file","a","data","generate","base64","compression","writeFileSync","resolvedOptions","assign","inputSourceMapFilename","errorHandler","sourceMaps","heapGraphFormat","errors","Map","errorList","diagnostic","location","set","printDiagnostics","foundFatal","size","printError","locString","severity","errorCode","message","callStack","eolPos","indexOf","substring","loc","sourceMessage","source","line","column","profiler","require","e","setSamplingInterval","startProfiling","processSerializedCode","serialized","err","stack","stopProfiling","Date","now","stream","createWriteStream","getNextToken","write","token","once","end","code","statistics","stats","RealmStatistics","getRealmStatistics","SerializerStatistics","getSerializerStatistics","TimingStatistics","projectPerformanceTrackers","pt","time","HeapStatistics","memory","MemoryStatistics","getHeapStatistics","stringify","heapGraph","__residual"],"mappings":"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","file":"prepack-cli.js","sourcesContent":["/**\n * Copyright (c) 2017-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n\n/* @flow */\n\n/* eslint-disable no-shadow */\n\nimport { CompilerDiagnostic, type ErrorHandlerResult, FatalError } from \"./errors.js\";\nimport {\n  type Compatibility,\n  CompatibilityValues,\n  type ReactOutputTypes,\n  ReactOutputValues,\n  type InvariantModeTypes,\n  InvariantModeValues,\n} from \"./options.js\";\nimport { type SerializedResult } from \"./serializer/types.js\";\nimport { prepackStdin, prepackFileSync } from \"./prepack-node.js\";\nimport type { BabelNodeSourceLocation } from \"babel-types\";\nimport fs from \"fs\";\nimport v8 from \"v8\";\nimport { version } from \"../package.json\";\nimport invariant from \"./invariant\";\nimport zipFactory from \"node-zip\";\nimport path from \"path\";\nimport JSONTokenizer from \"./utils/JSONTokenizer.js\";\n\n// Prepack helper\ndeclare var __residual: any;\n\nfunction run(\n  Object,\n  Array,\n  console,\n  JSON,\n  process,\n  prepackStdin,\n  prepackFileSync,\n  FatalError,\n  CompatibilityValues,\n  fs\n) {\n  let HELP_STR = `\n    input                    The name of the file to run Prepack over (for web please provide the single js bundle file)\n    --out                    The name of the output file\n    --compatibility          The target environment for Prepack [${CompatibilityValues.map(v => `\"${v}\"`).join(\", \")}]\n    --mathRandomSeed         If you want Prepack to evaluate Math.random() calls, please provide a seed.\n    --srcmapIn               The input sourcemap filename. If present, Prepack will output a sourcemap that maps from\n                             the original file (pre-input sourcemap) to Prepack's output\n    --srcmapOut              The output sourcemap filename.\n    --maxStackDepth          Specify the maximum call stack depth.\n    --timeout                The amount of time in seconds until Prepack should time out.\n    --lazyObjectsRuntime     Enable lazy objects feature and specify the JS runtime that support this feature.\n    --debugNames             Changes the output of Prepack so that for named functions and variables that get emitted into\n                             Prepack's output, the original name is appended as a suffix to Prepack's generated identifier.\n    --initializeMoreModules  Enable speculative initialization of modules (for the module system Prepack has builtin\n                             knowledge about). Prepack will try to execute all factory functions it is able to.\n    --trace                  Traces the order of module initialization.\n    --serialize              Serializes the partially evaluated global environment as a program that recreates it.\n                             (default = true)\n    --check [start[, count]] Check residual functions for diagnostic messages. Do not serialize or produce residual code.\n    --residual               Produces the residual program that results after constant folding.\n    --profile                Collect statistics about time and memory usage of the different internal passes\n    --logStatistics          Log statistics to console\n    --statsFile              The name of the output file where statistics will be written to.\n    --heapGraphFilePath      The name of the output file where heap graph will be written to.\n    --inlineExpressions      When generating code, tells prepack to avoid naming expressions when they are only used once,\n                             and instead inline them where they are used.\n    --invariantLevel         0: no invariants (default); 1: checks for abstract values; 2: checks for accessed built-ins; 3: internal consistency\n    --invariantMode          Whether to throw an exception or call a console function to log an invariant violation; default = throw.\n    --emitConcreteModel      Synthesize concrete model values for abstract models(defined by __assumeDataProperty).\n    --version                Output the version number.\n    --repro                  Create a zip file with all information needed to reproduce a Prepack run\"\n    --cpuprofile             Create a CPU profile file for the run that can be loaded into the Chrome JavaScript CPU Profile viewer\",\n  `;\n  let args = Array.from(process.argv);\n  args.splice(0, 2);\n  let inputFilenames = [];\n  let outputFilename;\n  let check: void | Array<number>;\n  let compatibility: Compatibility;\n  let mathRandomSeed;\n  let inputSourceMap;\n  let outputSourceMap;\n  let statsFileName;\n  let maxStackDepth: number;\n  let timeout: number;\n  let debugIdentifiers: void | Array<string>;\n  let lazyObjectsRuntime: string;\n  let heapGraphFilePath: void | string;\n  let debugInFilePath: string;\n  let debugOutFilePath: string;\n  let reactOutput: ReactOutputTypes = \"create-element\";\n  let reproFilePath: void | string;\n  let cpuprofilePath: void | string;\n  let invariantMode: void | InvariantModeTypes;\n  let invariantLevel: void | number;\n  let flags = {\n    initializeMoreModules: false,\n    trace: false,\n    debugNames: false,\n    emitConcreteModel: false,\n    inlineExpressions: false,\n    logStatistics: false,\n    logModules: false,\n    delayInitializations: false,\n    delayUnsupportedRequires: false,\n    accelerateUnsupportedRequires: true,\n    internalDebug: false,\n    debugScopes: false,\n    serialize: false,\n    residual: false,\n    profile: false,\n    reactEnabled: false,\n  };\n\n  let reproArguments = [];\n  let reproFileNames = [];\n  let inputFile = fileName => {\n    reproFileNames.push(fileName);\n    return path.basename(fileName);\n  };\n  while (args.length) {\n    let arg = args.shift();\n    if (!arg.startsWith(\"--\")) {\n      inputFilenames.push(arg);\n      reproArguments.push(inputFile(arg));\n    } else {\n      arg = arg.slice(2);\n      switch (arg) {\n        case \"out\":\n          arg = args.shift();\n          outputFilename = arg;\n          // do not include this in reproArguments needed by --repro, as path is likely not portable between environments\n          break;\n        case \"compatibility\":\n          arg = args.shift();\n          if (!CompatibilityValues.includes(arg)) {\n            console.error(`Unsupported compatibility: ${arg}`);\n            process.exit(1);\n          }\n          compatibility = (arg: any);\n          reproArguments.push(\"--compatibility\", compatibility);\n          break;\n        case \"mathRandomSeed\":\n          mathRandomSeed = args.shift();\n          reproArguments.push(\"--mathRandomSeed\", mathRandomSeed);\n          break;\n        case \"srcmapIn\":\n          inputSourceMap = args.shift();\n          reproArguments.push(\"--srcmapIn\", inputFile(inputSourceMap));\n          break;\n        case \"srcmapOut\":\n          outputSourceMap = args.shift();\n          // do not include this in reproArguments needed by --repro, as path is likely not portable between environments\n          break;\n        case \"statsFile\":\n          statsFileName = args.shift();\n          // do not include this in reproArguments needed by --repro, as path is likely not portable between environments\n          break;\n        case \"maxStackDepth\":\n          let value = args.shift();\n          if (isNaN(value)) {\n            console.error(\"Stack depth value must be a number\");\n            process.exit(1);\n          }\n          maxStackDepth = parseInt(value, 10);\n          reproArguments.push(\"--maxStackDepth\", maxStackDepth.toString());\n          break;\n        case \"timeout\":\n          let seconds = args.shift();\n          if (isNaN(seconds)) {\n            console.error(\"Timeout must be a number\");\n            process.exit(1);\n          }\n          timeout = parseInt(seconds, 10) * 1000;\n          reproArguments.push(\"--timeout\", timeout.toString());\n          break;\n        case \"debugIdentifiers\":\n          let debugIdentifiersString = args.shift();\n          debugIdentifiers = debugIdentifiersString.split(\",\");\n          reproArguments.push(\"--debugIdentifiers\", debugIdentifiersString);\n          break;\n        case \"check\":\n          let range = args.shift();\n          if (range.startsWith(\"--\")) {\n            args.unshift(range);\n            range = \"0\";\n          }\n          let pair: Array<any> = range.split(\",\");\n          if (pair.length === 1) pair.push(Number.MAX_SAFE_INTEGER);\n          let start = +pair[0];\n          if (start < 0 || !Number.isInteger(start)) {\n            console.error(\"check start offset must be a number\");\n            process.exit(1);\n          }\n          let count = +pair[1];\n          if (count < 0 || !Number.isInteger(count)) {\n            console.error(\"check count must be a number\");\n            process.exit(1);\n          }\n          check = [start, count];\n          reproArguments.push(\"--check\", range);\n          break;\n        case \"debugInFilePath\":\n          debugInFilePath = args.shift();\n          // do not include this in reproArguments needed by --repro, as debugger behavior is not currently supported for repros\n          break;\n        case \"debugOutFilePath\":\n          debugOutFilePath = args.shift();\n          // do not include this in reproArguments needed by --repro, as debugger behavior is not currently supported for repros\n          break;\n        case \"lazyObjectsRuntime\":\n          lazyObjectsRuntime = args.shift();\n          reproArguments.push(\"--lazyObjectsRuntime\", lazyObjectsRuntime);\n          break;\n        case \"heapGraphFilePath\":\n          heapGraphFilePath = args.shift();\n          // do not include this in reproArguments needed by --repro, as path is likely not portable between environments\n          break;\n        case \"reactOutput\":\n          arg = args.shift();\n          if (!ReactOutputValues.includes(arg)) {\n            console.error(`Unsupported reactOutput: ${arg}`);\n            process.exit(1);\n          }\n          reactOutput = (arg: any);\n          reproArguments.push(\"--reactOutput\", reactOutput);\n          break;\n        case \"repro\":\n          reproFilePath = args.shift();\n          // do not include this in reproArguments needed by --repro, as we don't need to create a repro from the repro...\n          break;\n        case \"cpuprofile\":\n          cpuprofilePath = args.shift();\n          // do not include this in reproArguments needed by --repro, as path is likely not portable between environments\n          break;\n        case \"invariantMode\":\n          arg = args.shift();\n          if (!InvariantModeValues.includes(arg)) {\n            console.error(`Unsupported invariantMode: ${arg}`);\n            process.exit(1);\n          }\n          invariantMode = (arg: any);\n          reproArguments.push(\"--invariantMode\", invariantMode);\n          break;\n        case \"invariantLevel\":\n          let invariantLevelString = args.shift();\n          if (isNaN(invariantLevelString)) {\n            console.error(\"invariantLevel must be a number\");\n            process.exit(1);\n          }\n          invariantLevel = parseInt(invariantLevelString, 10);\n          reproArguments.push(\"--invariantLevel\", invariantLevel.toString());\n          break;\n        case \"help\":\n          const options = [\n            \"-- | input.js\",\n            \"--out output.js\",\n            \"--compatibility jsc\",\n            \"--mathRandomSeed seedvalue\",\n            \"--srcmapIn inputMap\",\n            \"--srcmapOut outputMap\",\n            \"--maxStackDepth depthValue\",\n            \"--timeout seconds\",\n            \"--debugIdentifiers id1,id2,...\",\n            \"--check [start[, number]]\",\n            \"--lazyObjectsRuntime lazyObjectsRuntimeName\",\n            \"--heapGraphFilePath heapGraphFilePath\",\n            \"--reactOutput \" + ReactOutputValues.join(\" | \"),\n            \"--repro reprofile.zip\",\n            \"--cpuprofile name.cpuprofile\",\n            \"--invariantMode \" + InvariantModeValues.join(\" | \"),\n          ];\n          for (let flag of Object.keys(flags)) options.push(`--${flag}`);\n\n          console.log(\"Usage: prepack.js \" + options.map(option => `[ ${option} ]`).join(\" \") + \"\\n\" + HELP_STR);\n          return;\n        case \"version\":\n          console.log(version);\n          return;\n        default:\n          if (arg in flags) {\n            flags[arg] = true;\n            reproArguments.push(\"--\" + arg);\n          } else {\n            console.error(`Unknown option: ${arg}`);\n            process.exit(1);\n          }\n      }\n    }\n  }\n\n  if (reproFilePath !== undefined) {\n    const zip = zipFactory();\n    for (let fileName of reproFileNames) {\n      let content = fs.readFileSync(fileName, \"utf8\");\n      zip.file(path.basename(fileName), content);\n    }\n    zip.file(\n      \"repro.sh\",\n      `#!/bin/bash\nif [ -z \"$PREPACK\" ]; then\n  echo \"Set environment variable PREPACK to bin/prepack.js in your Prepack directory.\"\nelse\n  node \"$PREPACK\" ${reproArguments.map(a => `\"${a}\"`).join(\" \")}\nfi\n`\n    );\n    const data = zip.generate({ base64: false, compression: \"DEFLATE\" });\n    fs.writeFileSync(reproFilePath, data, \"binary\");\n  }\n\n  if (!flags.serialize && !flags.residual) flags.serialize = true;\n  if (check) {\n    flags.serialize = false;\n    flags.residual = false;\n  }\n\n  let resolvedOptions = Object.assign(\n    {},\n    {\n      compatibility,\n      mathRandomSeed,\n      inputSourceMapFilename: inputSourceMap,\n      errorHandler,\n      sourceMaps: !!outputSourceMap,\n      maxStackDepth,\n      timeout,\n      debugIdentifiers,\n      check,\n      lazyObjectsRuntime,\n      debugInFilePath,\n      debugOutFilePath,\n      reactOutput,\n      invariantMode,\n      invariantLevel,\n    },\n    flags\n  );\n  if (heapGraphFilePath) resolvedOptions.heapGraphFormat = \"DotLanguage\";\n  if (lazyObjectsRuntime && (resolvedOptions.delayInitializations || resolvedOptions.inlineExpressions)) {\n    console.error(\"lazy objects feature is incompatible with delayInitializations and inlineExpressions options\");\n    process.exit(1);\n  }\n\n  let errors: Map<BabelNodeSourceLocation, CompilerDiagnostic> = new Map();\n  let errorList: Array<CompilerDiagnostic> = [];\n  function errorHandler(diagnostic: CompilerDiagnostic): ErrorHandlerResult {\n    if (diagnostic.location) errors.set(diagnostic.location, diagnostic);\n    else errorList.push(diagnostic);\n    return \"Recover\";\n  }\n\n  function printDiagnostics(): boolean {\n    let foundFatal = false;\n    if (errors.size > 0 || errorList.length > 0) {\n      console.error(\"Errors found while prepacking\");\n      let printError = (error: CompilerDiagnostic, locString?: string = \"At an unknown location\") => {\n        foundFatal = foundFatal || error.severity === \"FatalError\";\n        console.error(\n          `${locString} ${error.severity} ${error.errorCode}: ${error.message}` +\n            ` (https://github.com/facebook/prepack/wiki/${error.errorCode})`\n        );\n        let callStack = error.callStack;\n        if (callStack !== undefined) {\n          let eolPos = callStack.indexOf(\"\\n\");\n          if (eolPos > 0) console.error(callStack.substring(eolPos + 1));\n        }\n      };\n      for (let [loc, error] of errors) {\n        let sourceMessage = \"\";\n        switch (loc.source) {\n          case null:\n          case \"\":\n            sourceMessage = \"In an unknown source file\";\n            break;\n          case \"no-filename-specified\":\n            sourceMessage = \"In stdin\";\n            break;\n          default:\n            invariant(loc !== null && loc.source !== null);\n            sourceMessage = `In input file ${loc.source}`;\n            break;\n        }\n\n        let locString = `${sourceMessage}(${loc.start.line}:${loc.start.column + 1})`;\n        printError(error, locString);\n      }\n      for (let error of errorList) printError(error);\n    }\n    return foundFatal;\n  }\n\n  let profiler;\n  try {\n    if (cpuprofilePath !== undefined) {\n      try {\n        profiler = require(\"v8-profiler\");\n      } catch (e) {\n        // Profiler optional dependency failed\n        console.error(\"v8-profiler doesn't work correctly on Windows, see issue #1695\");\n        throw e;\n      }\n      profiler.setSamplingInterval(100); // default is 1000us\n      profiler.startProfiling(\"\");\n    }\n\n    try {\n      if (inputFilenames.length === 0) {\n        prepackStdin(resolvedOptions, processSerializedCode, printDiagnostics);\n        return;\n      }\n      let serialized = prepackFileSync(inputFilenames, resolvedOptions);\n      printDiagnostics();\n      if (resolvedOptions.serialize && serialized) processSerializedCode(serialized);\n    } catch (err) {\n      printDiagnostics();\n      //FatalErrors must have generated at least one CompilerDiagnostic.\n      if (err instanceof FatalError) {\n        invariant(errors.size > 0 || errorList.length > 0, \"FatalError must generate at least one CompilerDiagnostic\");\n      } else {\n        // if it is not a FatalError, it means prepack failed, and we should display the Prepack stack trace.\n        console.error(err.stack);\n        process.exit(1);\n      }\n    }\n  } finally {\n    if (profiler !== undefined) {\n      let data = profiler.stopProfiling(\"\");\n      let start = Date.now();\n      invariant(cpuprofilePath !== undefined);\n      let stream = fs.createWriteStream(cpuprofilePath);\n      let getNextToken = JSONTokenizer(data);\n      let write = () => {\n        for (let token = getNextToken(); token !== undefined; token = getNextToken()) {\n          if (!stream.write(token)) {\n            stream.once(\"drain\", write);\n            return;\n          }\n        }\n        stream.end();\n        invariant(cpuprofilePath !== undefined);\n        console.log(`Wrote ${cpuprofilePath} in ${Date.now() - start}ms`);\n      };\n      write();\n    }\n  }\n\n  function processSerializedCode(serialized: SerializedResult) {\n    if (serialized.code === \"\") {\n      console.error(\"Prepack returned empty code.\");\n      return;\n    }\n    if (outputFilename) {\n      console.log(`Prepacked source code written to ${outputFilename}.`);\n      fs.writeFileSync(outputFilename, serialized.code);\n    } else {\n      console.log(serialized.code);\n    }\n    if (statsFileName) {\n      let statistics = serialized.statistics;\n      if (statistics === undefined) {\n        return;\n      }\n      let stats = {\n        RealmStatistics: statistics.getRealmStatistics(),\n        SerializerStatistics: statistics.getSerializerStatistics(),\n        TimingStatistics: statistics.projectPerformanceTrackers(\"Time\", pt => pt.time),\n        HeapStatistics: statistics.projectPerformanceTrackers(\"Memory\", pt => pt.memory),\n        MemoryStatistics: v8.getHeapStatistics(),\n      };\n      fs.writeFileSync(statsFileName, JSON.stringify(stats));\n    }\n    if (outputSourceMap) {\n      fs.writeFileSync(outputSourceMap, serialized.map ? JSON.stringify(serialized.map) : \"\");\n    }\n    if (heapGraphFilePath) {\n      invariant(serialized.heapGraph);\n      fs.writeFileSync(heapGraphFilePath, serialized.heapGraph);\n    }\n  }\n\n  return true;\n}\n\nif (typeof __residual === \"function\") {\n  // If we're running inside of Prepack. This is the residual function we'll\n  // want to leave untouched in the final program.\n  __residual(\n    \"boolean\",\n    run,\n    Object,\n    Array,\n    console,\n    JSON,\n    process,\n    prepackStdin,\n    prepackFileSync,\n    FatalError,\n    CompatibilityValues,\n    fs\n  );\n} else {\n  run(Object, Array, console, JSON, process, prepackStdin, prepackFileSync, FatalError, CompatibilityValues, fs);\n}\n"]}